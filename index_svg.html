<!DOCTYPE html>
<html lang="en">

<head>
    <style>
        #screen {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
        }

        #screenCanvas {
            border: 1px solid white;
            outline: 1px solid lightgray;
        }
    </style>
</head>

<body>
    <div id="screen">
        <svg id="mainSvg"></svg>
    </div>
</body>
<script>
    'use strict'
    function compareSeqToReference(refSeq, querySeq) {
        // returns array of pos,ref,alt arrays
        var diff = [...refSeq].map((x, i) => [i, x, querySeq[i]]).filter(x => x[1] != x[2])

        return diff
    }

    class SeqRowSvg {
        constructor(inputSeq, positionsArray, isReference) {
            this.variantRecs = positionsArray.map(x => [x, inputSeq.slice(x - 1, x)])
            this.elm = document.createElementNS("http://www.w3.org/2000/svg", "svg")
            this.isReference = isReference

            this.variantRecs.forEach((x, i) => {
                var position = x[0]
                var base = x[1]
                var groupElm = document.createElementNS("http://www.w3.org/2000/svg", "g")
                var bgElm = document.createElementNS("http://www.w3.org/2000/svg", "rect")
                var textElm = document.createElementNS("http://www.w3.org/2000/svg", "text")
                var textNode = document.createTextNode(base)

                bgElm.setAttribute("width", cellWidthPx)
                bgElm.setAttribute("height", cellHeightPx)
                bgElm.setAttribute("x", i * cellWidthPx)
                bgElm.setAttribute("y", 0)
                bgElm.setAttribute("fill", "red")
                bgElm.setAttribute("stroke", "black")
                bgElm.setAttribute("stroke-width", 3)

                textElm.setAttribute("x", (i * cellWidthPx) + (0.5 * cellWidthPx))
                textElm.setAttribute("y", 0.5 * cellHeightPx)
                textElm.setAttribute("fill", "black")
                textElm.setAttribute("text-anchor", "middle")
                textElm.setAttribute("dominant-baseline", "middle")
                textElm.append(textNode)


                groupElm.append(bgElm, textElm)

                this.elm.appendChild(groupElm)
            })
        }
    }

    function doProcessSeq() {
        var reference = "AATCGATGCTAGCTCATCTATCTA-CTAGCTGA"
        var seqArray = [
            "GATCGATGCTAGCACA-CTATCTAGCTAGCTGN",
            "GCTCGCTG-TCGCACA-CTATCTAGCTAGCTGN"
        ]


        // compare each query seq to the reference
        var comparisonArray = seqArray.map(x => compareSeqToReference(reference, x))

        // collect all the unique variant positions
        var variantPositions = [...new Set(comparisonArray.flat().map(x => x[0]))]

        // create new SeqRowSvg objects for each seq
        var refObj = new SeqRowSvg(reference, variantPositions, true)
        var seqObjs = seqArray.map(x => new SeqRowSvg(x, variantPositions))

        // add to DOM
        mainSvgElm.append(refObj)
        mainSvgElm.append(...seqObjs.map(x => x.elm))
    }

    // globals
    var mainSvgElm = document.getElementById("mainSvg");
    const cellWidthPx = 50
    const cellHeightPx = 50
    const cellBorderPx = 2

    var colour_palette = { "A": "#00800080", "C": "#daa52080", "T": "#4682b480", "G": "#cd5c5c80" }
    var colour_alpha = 0.5

    // init
    function init() {
        doProcessSeq()
    }

    init();
</script>

</html>